/*
 * @lc app=leetcode.cn id=123 lang=cpp
 *
 * [123] 买卖股票的最佳时机 III
 *
 * https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-iii/description/
 *
 * algorithms
 * Hard (58.26%)
 * Likes:    1352
 * Dislikes: 0
 * Total Accepted:    239.7K
 * Total Submissions: 411.3K
 * Testcase Example:  '[3,3,5,0,0,3,1,4]'
 *
 * 给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。
 * 
 * 设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。
 * 
 * 注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。
 * 
 * 
 * 
 * 示例 1:
 * 
 * 
 * 输入：prices = [3,3,5,0,0,3,1,4]
 * 输出：6
 * 解释：在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。
 * 随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。
 * 
 * 示例 2：
 * 
 * 
 * 输入：prices = [1,2,3,4,5]
 * 输出：4
 * 解释：在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4
 * 。   
 * 注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。   
 * 因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。
 * 
 * 
 * 示例 3：
 * 
 * 
 * 输入：prices = [7,6,4,3,1] 
 * 输出：0 
 * 解释：在这个情况下, 没有交易完成, 所以最大利润为 0。
 * 
 * 示例 4：
 * 
 * 
 * 输入：prices = [1]
 * 输出：0
 * 
 * 
 * 
 * 
 * 提示：
 * 
 * 
 * 1 
 * 0 
 * 
 * 
 */

// ----------------------- Dynamic Programming -----------------------
// Trade

// 
// @lc code=start
class Solution {
public:
    int maxProfit(vector<int>& prices) {
        vector<vector<int>> dp(5, vector<int>(prices.size()));
        // 2 * k + 1 个状态
        dp[0][0] = 0;
        dp[1][0] = -prices[0];
        dp[2][0] = 0;
        dp[3][0] = -10000000;        // 其实这里可以初始化成 0-prices[0] 第二次买入依赖于第一次卖出的状态，其实相当于第0天第一次买入了，第一次卖出了，然后再买入一次 
        dp[4][0] = -10000000;        // 
        if (prices.size() > 1) {     // 
            dp[3][1] = -1000000;     // 
            dp[4][1] = -1000000;     //
            if (prices.size() > 2)   //
                dp[4][2] = -1000000; //
        } 

        for (int i = 1; i < prices.size(); i++) {
            dp[0][i] = dp[0][i - 1];
            dp[1][i] = max(dp[1][i - 1], dp[0][i - 1] - prices[i]);
            dp[2][i] = max(dp[2][i - 1], dp[1][i - 1] + prices[i]);
            if (i > 1) {
                dp[3][i] = max(dp[3][i - 1], dp[2][i - 1] - prices[i]);
                if (i > 2)
                    dp[4][i] = max(dp[4][i - 1], dp[3][i - 1] + prices[i]);
            }
            // cout << dp[0][i] << ' ' << dp[1][i] << " " << dp[2][i] << " " << dp[3][i] << " " << dp[4][i] << endl; 
        }
        return max(dp[4][prices.size() - 1], dp[2][prices.size() - 1]);
    }
};
// @lc code=end

// 感觉对空间进行优化之后，物理意义就不再明确


=======================
[1,2,3,4,5]
--------------
4
=======================


======================================================= TLE
[64991,9784,7900,43964,50717,45519,58875,61883,47150,46882,24645,55035,65811,50383,45582,22590,8528,156,61005,53095,336,14789,5437,37870,48655,68974,60834,4856,28418,60274,47529,19699,6695,58207,43661,22376,33855,11141,46451,40646,44897,18194,17589,44497,994,3857,15162,28888,6820,36483,10770,39674,17614,5122,2113,6120,5767,55642,35447,6684,29161,64859,27915,35379,37081,48963,25489,55730,34994,9686,47187,16706,18188,61578,9384,27156,47766,20198,9661,32437,50182,10855,7599,36313,31101,66834,33605,56834,11883,3444,35948,47570,52992,25863,44193,42870,36120,13536,13153,59502,2640,59536,25716,19478,67661,17612,5753,53560,6740,21481,22762,2062,24604,34206,66436,34488,10659,47207,28853,68876,13299,48174,20644,65716,66286,56904,33448,20507,13493,6151,69903,54555,49215,46371,28538,43366,27320,47232,48253,15309,45526,66753,18450,62012,52789,5818,64287,39593,10545,16025,32178,11264,16483,29291,8157,16284,7635,50412,23738,3661,64601,20862,15248,14991,45874,15436,58947,13849,11178,18377,48097,55047,23190,46505,18744,24146,48994,48501,31669,40011,40543,34431,14300,1926,8859,68092,30388,18784,443,1138,3505,55579,66192,4203,41146,64411,7535,46924,13661,38676,2152,15186,42513,22737,8965,45845,21937,23383,67340,64907,68207,34221,17032,61491,25762,6366,17797,60630,9782,44696,3253,62248,23163,66517,20159,768,61353,7651,22682,62114,24904,23795,63820,21212,32627,59549,41379,14764,22165,54212,1967,67746,4678,49411,18928,8156,52977,37050,38910,50406,53244,13332,14496,45332,43540,16187,11885,62417,11386,47479,34595,11002,65814,43719,32640,63955,50708,41504,53360,45393,53749,52544,2128,232,43816,32716,10649,5406,7795,207,41526,55640,63687,43137,10723,20365,49499,44890,22326,489,68213,28077,25023,36970,20975,22971,64445,41426,39298,59902,33241,60637,7184,55502,19765,17882,41792,778,54760,28549,9895,3829,1964,26620,49156,4607,20859,11337,55489,61170,22865,2091,59284,18177,47928,35524,27866,24169,38027,41211,39691,22353,69709,30917,21440,35125,52006,52674,20330,5635,6563,38126,54179,1107,35410,59874,11525,26333,29215,24301,34436,50320,40065,15510,65373,6288,10768,59876,56206,4468,25636,50260,13545,61713,6796,59787,55628,12424,1339,16343,2755,20722,21262,28700,37539,30454,37234,15153,10867,12999,33545,43878,10480,52860,18573,38756,39583,63464,64681,11299,17203,46780,6606,43604,17520,13505,20536,69874,3016,69763,27849,50766,64869,6600,61149,67972,20145,9342,8032,54726,5178,41736,55380,20420,7716,14171,4175,67543,26296,16875,34555,5271,10968,53943,23568,40170,9162,58080,53742,68086,39530,9994,19577,8500,47270,46240,20126,47099,49812,27100,58053,38072,39388,9594,6211,24387,57159,19616,22398,31113,68345,29278,45632,47004,46558,56151,38979,52842,39492,38428,11534,41201,62536,4088,60384,60717,4759,38001,25979,20421,60798,32899,51413,40449,44369,28972,54722,9566,59493,38415,16579,9588,41983,36011,31763,39135,68142,28197,67701,35952,40896,62133,20956,56000,36942,33189,42141,115,28949,46118,13257,4624,33808,61264,23604,35019,15338,60168,4326,36364,47380,37348,39547,64828,20496,48824,28005,9998,24664,7201,45765,2252,67141,27989,32183,1698,45952,56558,62287,26277,2467,53790,1037,19033,18916,52498,25042,5422,49309,5367,61000,898,24608,737,15967,40273,8355,3582,14543,36270,29537,61272,62146,59364,7607,15976,24117,37230,33479,48918,69669,62077,34908,20813,29768,42837,66239,65831,20875,62594,32930,47719,3854,55413,48101,23496,44000,22364,35800,41692,69844,11041,60829,60792,11112,46154,44307,21448,26027,6763,8159,32739,22105,46447,13984,45865,43765,16161,12939,17482,23064,24728,33730,699,33852,58930,42063,66074,48430,66997,67327,27544,12110,62701,37971,50522,50925,28654,52584,21510,18344,45787,35581,63874,6592,10481,37165,61494,11939,6810,59030,56255,33446,53512,37709,25074,63630,28657,57568,54501,43896,2266,7074,21374,13104,19821,18309,22995,64524,57962,63576,64559,37111,14178,17114,43095,22505,53004,65776,5288,36973,48452,6216,65982,62705,32540,59995,20878,69879,60352,20792,36425,68136,3166,15706,2112,11184,68096,56204,37549,45180,51066,17036,46989,45310,13572,30139,39372,25210,41257,26905,25981,68920,35140,33458,14996,34645,51701,8405,41093,26987,56096,20773,56739,41484,29990,68725,8750,54655,43748,38590,22586,9582,21823,5162,20147,41540,22539,789,12206,20398,62292,24350,37192,26777,21259,24142,36648,26213,64849,48184,26909,34801,38516,69975,63549,13731,11319,68202,36696,1160,23528,30563,25468,5497,2869,36247,39777,42049,56552,17873,39098,18092,14293,20903,62961,17238,64073,11487,30458,55417,36376,39908,28543,25317,11611,65822,68382,25444,61270,23744,12070,22640,64178,1068,55737,31324,62451,38923,26403,27885,28049,22583,22998,66775,48720,15348,16457,50969,3131,15044,25930,2993,28446,60345,21593,54434,49959,43448,12924,31121,33578,57001,7679,52875,14828,63913,18149,19590,5450,3727,40976,66082,47453,51887,28856,51301,55558,62501,29928,10849,34985,6970,69750,20489,37644,14603,41677,2378,41276,58484,66700,48607,31012,50748,64383,44348,56165,13582,30758,10542,58860,69208,69437,24215,22063,11434,22477,34421,31825,29813,66649,58181,62901,37519,13107,22683,63076,54803,65271,66537,48056,7545,15196,12879,12090,23231,53187,27449,15541,25263,40551,480,42998,27713,55912,2531,1328,43011,66156,55053,3242,15127,45056,23897,20452,44994,23645,20943,35598,37694,51031,23418,15508,10914,19839,63411,17355,63480,26029,63609,1582,64180,22300,62304,66368,30704,62796,37964,55329,63442,5752,67427,40643,40246,63781,66773,53811,56583,16523,26880,21075,5016,3635,6093,14513,21688,13040,22584,58547,13093,4403,57584,27173,64600,63001,55621,50930,5218,905,24773,21737,68964,48352,35104,3796,20430,28402,2924,47334,62157,16468,41900,35106,9520,51913,60744,29421,46013,60863,6854,44405,50803,34276,12046,24006,20963,29698,3003,57918,57355,59366,56125,61693,64277,1878,63174,61357,8158,29966,65703,17467,65524,46373,29245,4277,37804,61483,19530,49044,69707,15128,4397,41533,11795,60904,53503,30160,46024,55031,28643,58690,42263,42675,12762,57167,8831,65945,21997,22624,20893,10846,29944,44275,37420,54541,65623,10260,6645,52408,52759,39967,7117,21732,42446,46598,25178,37003,748,52711,4344,47134,36331,55458,36872,2759,26047,66897,60943,45721,28324,47268,14528,37939,59061,26522,4573,51577,1265,59541,52077,13197,55511,67009,20647,20946,30245,40926,66301,65702,3432,24841,18101,11431,36436,8514,37990,69759,42360,16953,62170,48991,44043,22774,7283,48641,24545,2960,26958,12309,58166,44543,40350,54798,62950,35023,56875,30220,25397,25415,35635,33678,17317,41440,1691,13252,11347,50402,20706,39690,11298,17012,60049,51661,55689,14813,22221,46035,26788,48966,35618,56261,57168,5924,28419,48738,32189,45926,8989,13976,44366,11293,26323,63751,32253,15911,51856,68160,45536,1072,36379,49885,30519,61777,23838,58095,58302,34738,43122,30321,19249,66024,11034,22060,30813,55920,9294,38636,52451,1985,47476,65496,35230,62918,52852,43667,1268,46658,53908,19400,44837,26621,52044,69829,15006,48848,69951,52117,27321,22344,37249,35723,53073,20085,43052,36878,50715,23109,37353,13509,3990,29744,43284,65907,42068,23752,62467,23652,32112,60608,38230,58650,2181,65177,19808,16481,63448,22594,36258,67345,57701,62509,64756,3540,53253,2907,52244,40157,64704,25665,6892,66146,54603,68493,47036,17632,40602,42420,55545,9216,21342,28529,22463,48333,4191,52607,23845,42024,66563,15882,36320,66078,62702,49945,920,15000,49191,37166,54449,44207,11756,5463,51081,30129,24833,41713,15002,37550,35280,7351,39529,10153,28712,60419,58817,55291,47329,52659,41703,11813,51955,11619,29232,30488,39825,38841,57712,25504,54094,18049,26666,43208,62540,19992,62426,46425,53154,54448,5414,41796,25609,69421,31570,6573,45642,822,945,569,22156,60967,30621,45284,44329,36182,66922,37451,60810,45222,27158,68562,3747,55671,5286,64239,68472,56738,808,3400,4923,40987,60269,32880,4086,34189,57140,60747,43131,3819,21235,2111,41354,18624,34304,62439,55524,54834,5683,29872,55677,61453,36956,57729,55771,939,54300,46601,19588,33071,35677,67184,53334,36343,6826,2421,66584,34986,5395,25824,13229,26391,4879,31275,25579,1199,64351,50236,56804,49642,37273,24130,49634,21487,31018,5184,50633,32469,41990,5160,32523,20948,23857,28045,67952,59225,69978,53140,60185,20764,7168,34457,5859,14108,55450,55732,33850,15681,48180,59221,16200,55005,13834,9798,68818,27286,20490,40262,28560,20714,18129,49035,39981,44690,40969,20821,17054,54131,48504,27575,6072,13065,14580,59505,30526,42766,36139,32015,34725,61722,29779,63005,21755,51827,32025,7341,64016,51151,45607,40324,32407,18935,24750,49843,52184,67365,55,9089,67569,68858,28675,19524,40874,44595,58305,32557,46355,46174,68425,5316,36180,17977,4053,26632,4333,12031,33475,14761,29738,4511,8740,20808,25072,25334,28187,26308,10469,2656,54223,62414,19756,35218,63653,29077,69033,49327,32683,64179,33983,8175,38631,20720,2417,31391,65337,32936,47510,18746,9257,60691,68890,27762,3783,28201,48438,22968,36357,11514,12104,62003,55566,52946,9728,39783,63142,69897,57148,56633,3002,65293,34965,36818,14127,63107,46265,4769,10505,2916,32177,47384,43243,39984,61569,44008,25291,67275,35724,38024,63259,35465,56582,60415,18238,56571,33858,46936,2683,7610,23453,36913,51936,23719,17564,66668,57252,30315,48551,36273,66085,52830,51598,32106,31870,43291,30047,2523,31954,65787,46660,5967,69196,7349,7173,3931,31279,50368,34532,8371,69959,14015,33243,23075,16435,38734,34154,14900,67715,65363,54053,40850,56718,67742,69001,51330,37423,51372,3827,24675,52934,58963,62908,64202,27029,67509,8828,30394,48676,57255,21517,1270,59815,9823,47987,31363,9761,17634,10949,53519,33039,24208,44730,67519,47408,21878,59906,7530,8766,69703,26145,60199,67537,43133,44892,9022,22461,59453,27696,52503,31735,14830,12257,965,43854,15407,42551,3893,3235,67199,59919,61312,15464,67451,4129,30208,8608,42711,27667,3527,63034,67066,31034,26837,44558,13047,32637,69198,6301,1599,69642,68696,19343,52773,47091,45149,50166,56615,69826,7705,31560,60324,59795,60649,58543,36733,25339,38764,8207,13868,50066,48767,15626,41897,52800,15697,55196,23589,62394,48572,9995,3927,65936,69639,56760,46266,44310,31395,69868,24314,63325,62987,4921,7029,53960,40921,45939,69626,16598,34902,54836,39155,56958,18603,67096,53290,8323,13'... 398891 more character
-------------------------------------------------------
139994
=======================================================